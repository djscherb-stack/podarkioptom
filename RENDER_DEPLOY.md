# Выгрузка на Render.com

Пошаговая инструкция, чтобы развернуть аналитику (с ИИ) в интернете и работать с полными данными.

---

## 1. Репозиторий на GitHub

Если проект ещё не в GitHub:

```bash
cd /Users/dmitriy/ProAnalitik
git init   # если ещё не репозиторий
git add .
git commit -m "Deploy: аналитика + ИИ-аналитика за день"
git branch -M main
git remote add origin https://github.com/ВАШ_ЛОГИН/ProAnalitik.git
git push -u origin main
```

Если репозиторий уже есть — просто закоммитьте и запушьте все изменения:

```bash
git add .
git status   # проверьте, что нет лишнего (.env и data/ не должны попасть в коммит)
git commit -m "ИИ-аналитика, фикс промпта, деплой на Render"
git push origin main
```

---

## 2. Сервис на Render

1. Зайдите на [render.com](https://render.com), войдите или зарегистрируйтесь.
2. **Dashboard** → **New** → **Web Service**.
3. Подключите репозиторий GitHub (если ещё не подключён — авторизуйте Render в GitHub и выберите репозиторий `ProAnalitik`).
4. Настройки:
   - **Name:** `proanalitik` (или любое; от него будет URL: `https://proanalitik.onrender.com`).
   - **Region:** выберите ближайший.
   - **Runtime:** **Docker** (в проекте есть `render.yaml` и `Dockerfile`).
   - Остальное можно оставить по умолчанию; Render подхватит `render.yaml`, если он в корне.

---

## 3. Переменные окружения (Environment)

В настройках сервиса откройте **Environment** и добавьте переменные:

| Переменная | Описание | Обязательно |
|------------|----------|-------------|
| `ANALYTICS_USER` | Логин для входа в аналитику | Да |
| `ANALYTICS_PASSWORD` | Пароль для входа | Да |
| `OPENAI_API_KEY` | Ключ OpenAI для ИИ-аналитики (начинается с `sk-...`) | Для ИИ-аналитики |
| `OPENAI_MODEL` | Модель, например `gpt-4o-mini` | Нет (есть по умолчанию) |
| `CORS_ORIGINS` | Доп. домены через запятую, если открываете с другого домена | Нет |
| `UPLOAD_TOKEN` | Токен для загрузки по API / Mailparser | Если нужна автоматическая загрузка |
| `DATA_DIR` | Путь к папке с Excel, если используете диск | По необходимости |

На бесплатном тарифе **секреты** (пароли, ключи) задаются в том же разделе Environment.

---

## 4. Диск для данных (по желанию)

Чтобы Excel-файлы не терялись при перезапуске сервиса:

1. В Render: **Settings** → **Disks** → **Add Disk**.
2. Имя, например `proanalitik-data`, путь монтирования: `/app/data`.
3. В **Environment** добавьте: `DATA_DIR=/app/data`.

Тогда загруженные через интерфейс файлы будут сохраняться на диске. Без диска они живут только до следующего деплоя/рестарта.

---

## 5. Деплой

- **Manual Deploy:** в Dashboard нажмите **Manual Deploy** → **Deploy latest commit**.
- **Auto Deploy:** при включённом **Auto-Deploy** каждый `git push` в выбранную ветку будет запускать новый деплой.

Дождитесь окончания сборки (Build) и запуска (Deploy). В логах не должно быть ошибок.

---

## 6. Открыть в браузере

- URL сервиса: **https://proanalitik.onrender.com** (или тот, что показан в Render).
- Войдите под `ANALYTICS_USER` / `ANALYTICS_PASSWORD`.
- Загрузите Excel через интерфейс (Админ или кнопка загрузки) или настройте синхронизацию с Google Drive / Mailparser, если нужно.
- Страница **«По дню»** → кнопка **«Запустить ИИ-аналитику»** — должна работать при заданном `OPENAI_API_KEY`.

---

## Обновление (полные данные и код)

1. Локально подтяните/закоммитьте изменения, запушьте в `main`:
   ```bash
   git add .
   git commit -m "Обновление данных или правки"
   git push origin main
   ```
2. Если включён Auto-Deploy — Render сам пересоберёт и перезапустит сервис.
3. Иначе в Dashboard нажмите **Manual Deploy** → **Deploy latest commit**.

После деплоя аналитика и ИИ-аналитика будут работать на полных данных в интернете.
